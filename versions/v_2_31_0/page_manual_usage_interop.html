<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Angelscript addon Template Containers: C++ / Angelscript interoperability</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Angelscript addon Template Containers
   &#160;<span id="projectnumber">2.31.0</span>
   </div>
   <div id="projectbrief">STL container powerr for Angelscript</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_manual_usage_interop.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">C++ / Angelscript interoperability </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>All containers can be created in C++ or angelscript. The angelscript side is more convenient.</p>
<p>C++ side quirks</p>
<ul>
<li>All containers are registered with angelscript as ref types<ul>
<li>They must be created with new and deleted with container-&gt;refcount_Release()</li>
</ul>
</li>
<li>Tempspec'd containers use real C++ types and are actually nice to use unlike...</li>
<li>Templated containers support all types and thus their interface is full of voidpointers.<ul>
<li>Templated containers internally store each item in an <a class="el" href="structaatc_1_1common_1_1primunion.html" title="This monstrosity is used to store any primitive or handle using the same allocation code...">aatc::common::primunion</a> to avoid different allocation code<ul>
<li>If the content is object or handle, primunion.ptr is a void* which points at the object</li>
</ul>
</li>
</ul>
</li>
<li>AATC containers hold their native container in my_aatc_container.container<ul>
<li>The native container should be used for iteration, the AATC container's functions should be used for everything else</li>
</ul>
</li>
</ul>
<p><br />
</p>
<p>Angelscript side quirks</p>
<ul>
<li>You must be careful when passing around containers to avoid accidental copies of entire containers<ul>
<li>"Container@" will not copy</li>
<li>"Container &amp;in" would copy, but doesn't even compile (because containers' opAssign and copy constructor are registered to take a handle)</li>
<li>"Container &amp;out" will copy</li>
<li>"Container &amp;inout" will not copy</li>
</ul>
</li>
</ul>
<p><br />
</p>
<p>Example of creating a vector&lt;int&gt; in C++ then passing it to angelscript:</p>
<div class="fragment"><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="preprocessor">#include &quot;aatc_container_vector.hpp&quot;</span></div><div class="line"></div><div class="line"></div><div class="line">{</div><div class="line">    <a class="code" href="classaatc_1_1container_1_1tempspec_1_1vector.html">aatc::container::tempspec::vector&lt;int&gt;</a>* cont = <span class="keyword">new</span> <a class="code" href="classaatc_1_1container_1_1tempspec_1_1vector.html">aatc::container::tempspec::vector&lt;int&gt;</a>;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; i++) {</div><div class="line">        cont-&gt;push_back(i);</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="comment">//Increment refcount here if you want C++ to have ownership of your container</span></div><div class="line">    <span class="comment">//cont-&gt;refcount_Add()</span></div><div class="line"></div><div class="line">    asIScriptFunction* scriptfunc = my_module-&gt;GetFunctionByName(<span class="stringliteral">&quot;angelscript_function_who_wants_a_vector&quot;</span>);</div><div class="line">        context-&gt;Prepare(scriptfunc);</div><div class="line">        context-&gt;SetArgAddress(0, cont);</div><div class="line">    context-&gt;Execute();</div><div class="line">    </div><div class="line">    <span class="comment">//The angelscript function will decrement the container&#39;s refcount after its done running and delete it unless you incremented the refcount above with cont-&gt;refcount_Add()</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> angelscript_function_who_wants_a_vector(vector&lt;int&gt;@ cont){</div><div class="line">    <span class="keywordflow">for</span>(<span class="keyword">auto</span> it = cont.begin();it++;){</div><div class="line">        Print(<span class="stringliteral">&quot;value = &quot;</span> + it.value);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//Prints</span></div><div class="line"><span class="comment">//Prints</span></div><div class="line"><span class="comment">//Prints</span></div><div class="line">value = 0</div><div class="line">value = 1</div><div class="line">value = 2</div><div class="line">value = 3</div></div><!-- fragment --><p> <br />
</p>
<p>Example of creating a map&lt;int,int&gt; in C++ then passing it to angelscript:</p>
<div class="fragment"><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="preprocessor">#include &quot;aatc_container_map.hpp&quot;</span></div><div class="line"></div><div class="line"></div><div class="line">{</div><div class="line">    <span class="comment">//typeinfo is required for templated containers</span></div><div class="line">    asITypeInfo* tinfo = my_engine-&gt;GetTypeInfoByDecl(<span class="stringliteral">&quot;map&lt;int,int&gt;&quot;</span>);</div><div class="line">    </div><div class="line">    <a class="code" href="classaatc_1_1container_1_1mapped_1_1templated_1_1map.html">aatc::container::mapped::templated::map</a>* cont = <span class="keyword">new</span> <a class="code" href="classaatc_1_1container_1_1mapped_1_1templated_1_1map.html">aatc::container::mapped::templated::map</a>(tinfo);</div><div class="line"></div><div class="line">    <span class="comment">//Working with templated containers is a pain in C++, because everything wants a void*</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; i++) {</div><div class="line">        <span class="keywordtype">int</span> key = i;</div><div class="line">        <span class="keywordtype">int</span> value = 100 + i;</div><div class="line">        cont-&gt;insert(&amp;key, &amp;value);</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="comment">//Increment refcount here if you want C++ to have ownership of your container</span></div><div class="line">    <span class="comment">//cont-&gt;refcount_Add()</span></div><div class="line"></div><div class="line">    asIScriptFunction* scriptfunc = my_module-&gt;GetFunctionByName(<span class="stringliteral">&quot;angelscript_function_who_wants_a_map&quot;</span>);</div><div class="line">        context-&gt;Prepare(scriptfunc);</div><div class="line">        context-&gt;SetArgAddress(0, cont);</div><div class="line">    context-&gt;Execute();</div><div class="line">    </div><div class="line">    <span class="comment">//The angelscript function will decrement the container&#39;s refcount after its done running and delete it unless you incremented the refcount above with cont-&gt;refcount_Add()</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> angelscript_function_who_wants_a_map(map&lt;int,int&gt;@ cont){</div><div class="line">    <span class="keywordflow">for</span>(<span class="keyword">auto</span> it = cont.begin();it++;){</div><div class="line">        Print(<span class="stringliteral">&quot;key = &quot;</span> + it.key + <span class="stringliteral">&quot;   value = &quot;</span> + it.value);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//Prints</span></div><div class="line"><span class="comment">//Prints</span></div><div class="line"><span class="comment">//Prints</span></div><div class="line">key = 0   value = 100</div><div class="line">key = 1   value = 101</div><div class="line">key = 2   value = 102</div><div class="line">key = 3   value = 103</div></div><!-- fragment --><p> <br />
</p>
<p>Example of creating a vector&lt;int&gt; in angelscript then passing it to C++:</p>
<div class="fragment"><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="preprocessor">#include &quot;aatc_container_vector.hpp&quot;</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> cpp_read_vector(<a class="code" href="classaatc_1_1container_1_1tempspec_1_1vector.html">aatc::container::tempspec::vector&lt;int&gt;</a>* cont) {</div><div class="line">    MySuperPrint(<span class="stringliteral">&quot;size = &quot;</span> + cont-&gt;size());</div><div class="line">    </div><div class="line">    <span class="comment">//cont-&gt;container is the native std::vector&lt;int&gt; which the AATC container uses for storage</span></div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v : cont-&gt;container){</div><div class="line">        MySuperPrint(<span class="stringliteral">&quot;value = &quot;</span> + v);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">{<span class="comment">//Registration</span></div><div class="line">    engine-&gt;RegisterGlobalFunction(<span class="stringliteral">&quot;void cpp_read_vector(vector&lt;int&gt;@)&quot;</span>, asFUNCTION(cpp_read_vector), asCALL_CDECL);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> my_scriptmain(){</div><div class="line">    vector&lt;int&gt; cont;</div><div class="line">    </div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;5;i++){</div><div class="line">        cont.push_back(i);</div><div class="line">    }</div><div class="line">    </div><div class="line">    cpp_read_vector(cont);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//Prints</span></div><div class="line"><span class="comment">//Prints</span></div><div class="line"><span class="comment">//Prints</span></div><div class="line">size = 5</div><div class="line">value = 0</div><div class="line">value = 1</div><div class="line">value = 2</div><div class="line">value = 3</div><div class="line">value = 4</div></div><!-- fragment --><p> <br />
</p>
<p>Example of creating a map&lt;int,int&gt; in angelscript then passing it to C++ and iterating the map in C++:</p>
<div class="fragment"><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="preprocessor">#include &quot;aatc_container_map.hpp&quot;</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> cpp_read_map(<a class="code" href="classaatc_1_1container_1_1mapped_1_1templated_1_1map.html">aatc::container::mapped::templated::map</a>&amp; cont) {</div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">        Cont has its typeinfo set during construction in angelscript.</span></div><div class="line"><span class="comment">        </span></div><div class="line"><span class="comment">        We could examine it here with:</span></div><div class="line"><span class="comment">            cont-&gt;typeinfo_container</span></div><div class="line"><span class="comment">            cont-&gt;typeinfo_key</span></div><div class="line"><span class="comment">            cont-&gt;typeinfo_value</span></div><div class="line"><span class="comment">        </span></div><div class="line"><span class="comment">        But we already know that:</span></div><div class="line"><span class="comment">            cont-&gt;typeinfo_container == my_engine-&gt;GetTypeInfoByDecl(&quot;map&lt;int,int&gt;&quot;)</span></div><div class="line"><span class="comment">                cont-&gt;typeinfo_container-&gt;GetSubTypeId(0) == asTYPEID_INT32</span></div><div class="line"><span class="comment">                cont-&gt;typeinfo_container-&gt;GetSubTypeId(1) == asTYPEID_INT32</span></div><div class="line"><span class="comment">            </span></div><div class="line"><span class="comment">            cont-&gt;typeinfo_key == NULL</span></div><div class="line"><span class="comment">            cont-&gt;typeinfo_value == NULL</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    </div><div class="line">    MySuperPrint(<span class="stringliteral">&quot;size = &quot;</span> + cont-&gt;size());</div><div class="line">    </div><div class="line">    <span class="comment">//cont-&gt;container is the native std::map&lt;primunion,primunion&gt; which the AATC container uses for storage</span></div><div class="line">    <span class="keywordflow">for</span>(aatc::common::primunion_pair <span class="keyword">const</span>&amp; pup : cont.container){</div><div class="line">        MySuperPrint(<span class="stringliteral">&quot;key = &quot;</span> + pup.first.i32 + <span class="stringliteral">&quot;   value = &quot;</span> + pup.second.i32);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">{<span class="comment">//Registration</span></div><div class="line">    engine-&gt;RegisterGlobalFunction(<span class="stringliteral">&quot;void cpp_read_map(map&lt;int,int&gt; &amp;inout)&quot;</span>, asFUNCTION(cpp_read_map), asCALL_CDECL);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> my_scriptmain(){</div><div class="line">    map&lt;int,int&gt; cont;</div><div class="line">    </div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;5;i++){</div><div class="line">        cont.insert(i,100 + i);</div><div class="line">    }</div><div class="line">    </div><div class="line">    cpp_read_map(cont);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//Prints</span></div><div class="line"><span class="comment">//Prints</span></div><div class="line"><span class="comment">//Prints</span></div><div class="line">size = 5</div><div class="line">key = 0   value = 100</div><div class="line">key = 1   value = 101</div><div class="line">key = 2   value = 102</div><div class="line">key = 3   value = 103</div><div class="line">key = 4   value = 104</div></div><!-- fragment --><p> <br />
</p>
<p>Example of creating a map&lt;string,string&gt; in angelscript then passing it to C++ and iterating the map in C++:</p>
<div class="fragment"><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="comment">//C++ side</span></div><div class="line"><span class="preprocessor">#include &quot;aatc_container_map.hpp&quot;</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> cpp_read_map(<a class="code" href="classaatc_1_1container_1_1mapped_1_1templated_1_1map.html">aatc::container::mapped::templated::map</a>&amp; cont) {</div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">        Cont has its typeinfo set during construction in angelscript.</span></div><div class="line"><span class="comment">        </span></div><div class="line"><span class="comment">        We could examine it here with:</span></div><div class="line"><span class="comment">            cont-&gt;typeinfo_container</span></div><div class="line"><span class="comment">            cont-&gt;typeinfo_key</span></div><div class="line"><span class="comment">            cont-&gt;typeinfo_value</span></div><div class="line"><span class="comment">        </span></div><div class="line"><span class="comment">        But we already know that:</span></div><div class="line"><span class="comment">            cont-&gt;typeinfo_container == my_engine-&gt;GetTypeInfoByDecl(&quot;map&lt;string,string&gt;&quot;)</span></div><div class="line"><span class="comment">            cont-&gt;typeinfo_key == my_engine-&gt;GetTypeInfoByDecl(&quot;string&quot;)</span></div><div class="line"><span class="comment">            cont-&gt;typeinfo_value == my_engine-&gt;GetTypeInfoByDecl(&quot;string&quot;)</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    </div><div class="line">    MySuperPrint(<span class="stringliteral">&quot;size = &quot;</span> + cont-&gt;size());</div><div class="line">    </div><div class="line">    <span class="comment">//cont-&gt;container is the native std::map&lt;primunion,primunion&gt; which the AATC container uses for storage</span></div><div class="line">    <span class="keywordflow">for</span>(aatc::common::primunion_pair <span class="keyword">const</span>&amp; pup : cont.container){</div><div class="line">        std::string* key = (std::string*)pup.first.ptr;</div><div class="line">        std::string* value = (std::string*)pup.second.ptr;</div><div class="line">        </div><div class="line">        MySuperPrint(<span class="stringliteral">&quot;key = &quot;</span> + *key + <span class="stringliteral">&quot;   value = &quot;</span> + *value);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">{<span class="comment">//Registration</span></div><div class="line">    engine-&gt;RegisterGlobalFunction(<span class="stringliteral">&quot;void cpp_read_map(map&lt;string,string&gt; &amp;inout)&quot;</span>, asFUNCTION(cpp_read_map), asCALL_CDECL);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"><span class="comment">//Angelscript side</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> my_scriptmain(){</div><div class="line">    map&lt;string,string&gt; cont;</div><div class="line">    </div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;5;i++){</div><div class="line">        cont.insert(<span class="stringliteral">&quot;s&quot;</span> + i,<span class="stringliteral">&quot;ss&quot;</span> + 100 + i);</div><div class="line">    }</div><div class="line">    </div><div class="line">    cpp_read_map(cont);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//Prints</span></div><div class="line"><span class="comment">//Prints</span></div><div class="line"><span class="comment">//Prints</span></div><div class="line">size = 5</div><div class="line">key = s0   value = ss100</div><div class="line">key = s1   value = ss101</div><div class="line">key = s2   value = ss102</div><div class="line">key = s3   value = ss103</div><div class="line">key = s4   value = ss104</div></div><!-- fragment --><p> <br />
</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Manual</a></li><li class="navelem"><a class="el" href="page_manual_usage.html">Usage</a></li>
    <li class="footer">Generated on Tue Mar 15 2016 16:19:56 for Angelscript addon Template Containers by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
